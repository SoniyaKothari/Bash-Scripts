#!/bin/bash
# Simple System Health Monitor
# Checks CPU, Memory, Disk usage, top processes, and critical services

echo "SYSTEM HEALTH REPORT"
echo "Date: $(date)"
echo ""

# CPU Usage
echo "CPU Usage:"
cpu_idle=$(top -bn1 | grep "Cpu(s)" | awk '{print $8}')
cpu_usage=$(echo "scale=1; 100 - $cpu_idle" | bc)
echo "  $cpu_usage% used"
echo ""

# Memory Usage
echo "Memory Usage:"
free -h | awk '/Mem:/ {printf "  Total: %s | Used: %s | Free: %s\n", $2, $3, $4}'
echo ""

# Disk Usage
echo "Disk Usage:"
df -h | grep -E '^/dev/' | awk '{printf "  %s: %s used (%s/%s)\n", $1, $5, $3, $2}'
echo ""

# Top 5 Memory Consuming Processes
echo "Top 5 Memory Consuming Processes:"
ps aux --sort=-%mem | head -6 | tail -5 | awk '{printf "  %-20s - %s%%\n", $11, $4}'
echo ""

# Critical Services Status
echo "Critical Services Status:"
services=("ssh" "docker" "nginx" "mysql")
for service in "${services[@]}"; do
    if systemctl is-active --quiet "$service" 2>/dev/null; then
        echo "  $service: running"
    else
        echo "  $service: NOT running"
    fi
done
echo ""

echo "End of Report"
